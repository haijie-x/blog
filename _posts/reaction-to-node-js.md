---
title: "Reaction to 深入浅出Node.js"
excerpt: "《深入浅出Node.js》阅读摘录"
coverImage: "/assets/blog/reaction-to-node-js/cover.jpg"
date: "2023-04-16T14:34:54.096Z"
ogImage:
  url: "/assets/blog/reaction-to-node-js/cover.jpg"
---

最近在读朴灵老师的《深入学习 Node.js》，虽然这本书出版于 2013 年，距离现在已有十年，但风评都说它是 Node.js 的圣经，正好本人在学习 Node.Js，故在此做些关于该书的笔记与摘录。

本篇文章的目录将于这本书保持一致，方便自己回顾学习与读者阅读，以下思考将统称 Node.js 为 Node。

## 1 Node 简介

### 1.1 Node 的诞生历程

众所周知，学习一门知识需要了解其历史，下面来聊聊 Node 是如何诞生的。\
2009 年 3 月，Ryan Dahl 在其博客上宣布准备基于 V8 创建一个轻量级的 Web 服务器并提供一套库。\
2009 年 5 月 Ryan Dahl 在 github 上发布了 nodejs 的最初版本。\
2012 年 1 月底，Ryan Dahl 在对 Node 架构设计满意的情况下，将掌门人的身份转交给 Isaac Z. Schlueter，自己转向一些研究项目。Isaac Z. Schlueter 是 Node 的包管理器 NPM 的作者，之后 Node 的版本发布和 bug 修复等工作由他接手。\
随后，Node 的发布计划主要集中在性能提升上，在 v0.14 之后，正式发布出 v1.0 版本。

### 1.2 Node 的命名与起源

起初，Node 作者只是想开发一款 Web 应用，它又是如何发展成拥有庞大生态的 Node 呢。

#### 1.2.1 为什么是 JavaScript

Node 作者明白设计高性能，Web 服务器的几个要点：事件驱动、非阻塞 I/O。作者曾评估过一系列语言，发现 JavaScript 并无非阻塞 I/O 的历史包袱，同时，事件驱动已经在浏览器内得到良好体现。

#### 1.2.2 为什么叫 Node

Node 发展为一个强制不共享任何资源的单线程、单进程系统，包含十分适宜网络的库，为构建大型分布式应用程序提供基础设施，其目标也是成为一个构建快速、可伸缩的网络应用平台。每一个 Node 进程都构成这个网络应用中的一个节点，这是它名字所含意义的真谛。

### 1.3 Node 给 JavaScript 带来的意义

除了 HTML、WebKit 和显卡这些 UI 相关技术没有支持外，Node 的结构与 Chrome 十分相似。它们都是基于事件驱动的异步架构，浏览器通过事件驱动来服务界面上的交互，Node 通过事件驱动来服务 I/O。Node 打破了过去 JavaScript 只能在浏览器中运行的局面。前后端编程环境统一，可以大大降低前后端转换所需要的上下文交换代价。

### 1.4 Node 的特点

#### 1.4.1 异步 I/O

在 Node 中，绝大多数的操作都以异步的方式进行调用。Ryan Dahl 排除万难，在底层构建了很多异步 I/O 的 API，从文件读取到网络请求等，均是如此。这样的意义在于，在 Node 中，我们可以从语言层面很自然地进行并行 I/O 操作。每个调用之间无须等待之前的 I/O 调用结束。在编程模型上可以极大提升效率。下面的两个文件读取任务的耗时取决于最慢的那个文件读取的耗时：

fs.readFile('/path1', function (err, file) {
console.log(’读取文件 1 完成’);
});
fs.readFile('/path2', function (err, file) {
console.log(’读取文件 2 完成’);
});

而对于同步 I/O 而言，它们的耗时是两个任务的耗时之和。这里异步带来的优势是显而易见的。

#### 1.4.2 事件与回调函数

事件的编程方式具有轻量级、松耦合、只关注事务点等优势，但是在多个异步任务的场景下，事件与事件之间各自独立，如何协作是一个问题。回调函数无处不在，这是因为在 JavaScript 中，我们将函数作为第一等公民来对待，可以将函数作为对象传递给方法作为实参进行调用。

在转变为异步编程思维后，通过对业务的划分和对事件的提炼，在流程控制方面处理业务的复杂度与同步方式实际上是一致的。

#### 1.4.3 单线程

Node 保持了 JavaScript 在浏览器中单线程的特点。而且在 Node 中，JavaScript 与其余线程是无法共享任何状态的。单线程的最大好处是不用像多线程编程那样处处在意状态的同步问题，这里没有死锁的存在，也没有线程上下文交换所带来的性能上的开销。

同样，单线程也有它自身的弱点，这些弱点是学习 Node 的过程中必须要面对的。积极面对这些弱点，可以享受到 Node 带来的好处，也能避免潜在的问题，使其得以高效利用。单线程的弱点具体有以下 3 方面。\
❑ 无法利用多核 CPU。\
❑ 错误会引起整个应用退出，应用的健壮性值得考验。\
❑ 大量计算占用 CPU 导致无法继续调用异步 I/O。

#### 1.4.4 跨平台

通过良好的架构，Node 的第三方 C++模块也可以借助 libuv 实现跨平台。目前，除了没有保持更新的 C++模块外，大部分 C++模块都能实现跨平台的兼容。
